title: Прогресс по звонилке
summary: Рассказ о том, чего делается в приложении Texr, которое я пишу
pub_date: 2013-07-13
tags: [code, voip, texr]

Воццап
======

Ежели кто еще не вкурсе, я пишу `приложение`_ для телефонов, линуксов и
броузера, через которое можно звонить сипом и говорить голосом.

От кучи других сип-звонилок оно отличается тем, что я не делаю клиент, к
которому нужно искать какого-то провайдера, а потом ковыряться с настройками,
а в итоге получить непонятную фигню, через которую можно звонить на обычные
мобильные и городские номера, но дешевле.

Я делаю штуку, у которой будет своя адресная книга, история звонков и которая
придумана, чтобы звонить с одного сип-телефона на другой. Наружу тоже звонить
можно, но это дополнительная фича, которая немного сбоку.

Собственно можно звонить даже снаружи, если иметь правильного провайдера. Сам
я пока что не могу продавать-покупать телефонные номера и трафик, поэтому фича
очень сбоку.

SIP
---

Что такое SIP никто толком не знает, кроме нескольких бородатых чуваков,
которые обоснованно считают его говном. Все остальные знают, что это такой
открытый протокол, через который можно звонить. Это вобщемто правда, а
в подробности пускай вдаются специальные обученные люди.

Прогресс
--------

В начале июна на меня упала куча всяких Очень Важных Дел, включая работу, за
которую мне платят деньгами и людей с которыми я разговариваю слова.

Сейчас с работой я немного разгребся, поэтому андроидное приложение, которое
выглядело совсем никак, теперь `выглядит страшно`_, но работает. Айосовое,
напоминаю, `выглядит программистично`_, но уже болтается в аппсторе.

Сервер
------

Еще я периодически пилю сервер и это должно быть видно по меняющимся циферкам
в хедере с версией, котормую можно `посмотреть скриптом`_.

Например я сделал гейты рабочими до такой степени, что входящие звонки на
интертелеком попадают через SIP аккуратно мне в аккаунт. Исходящие работали
давно, а тут и в обратную сторону завелось.

Секюрити
--------

Ну и конечно же, я не сливаю трафик Службе Брелоков Украины и прочим NSA,
голосовой трафик криптуется четким SRTP и ходит напрямую между абонентами.

Андроид
-------

На андроидной версии стала кое-как работать история звонков. Если точнее, я вытащил
код, который работает с историей, из приложения и засунул его в драйвер.
Драйвер - это тот кусок, который у меня одинаковый на всех платформах (кроме
звука конечно) и в который можно стучать вот таким `скриптом через IPC`_.

Я пока еще раздумываю над тем, выкладывать ли драйвер в опенсорц, точнее
*когда* его выкладывать. Бинарники для линукса (включая армовый) и макоси я выложу в
тот момент, когда сделаю проверку телефонного номера на правильность через
SMS. Сейчас можно создавать аккаунты с любыми номерами, поэтому "ой".

Еще в андроиде заработала кнопка логина - опять же, я вытащил код из
айосно-специфичной части в драйвер. Андроидный кусок просто шлет драйверу
команду через IPC, а там сами разбираются.

Создавалка аккаунтов есть только в айосной версии, а проверялки номеров через SMS нету вообще нигде.

Мемлики
-------

Еще я потратил дня два или три на то, что гонял драйвер под valgrind и починил
кучу адского ада - по этому поводу надо бы обновить сборку от iOS, но там
ничего особо смертельного нету.

Линукс
------

Линуксовая версия в виде отдельного драйвера у меня появилась еще месяц назад.
Сейчас я ее поставил на армовую железку, прицепил микровофон и поставил у
своей бабушки. Никакого монитора и клавиатуры там нету, хотел прицепить
ИК-пульт, но он категорически не работает по какой-то странной причине. Даже
из юзерспейса через libusb не смог ни байта данных вытащить. Или сдох или чего
- не пойму.

Ну и сделал скрипт, который автоматически принимает все звонки. Удобно
получилось, ага.

Сайт
----

На сайте все плохо, ничего не работает, а WebRTC вообще отвалился нафиг. 

Или спеку обновили или реализацию в хроме или оно такое и было,
а отвалился интерконнект в десктопно-лиуксово-мобильной версии.

Деньги
------

Собственно я все делаю неправильно и очень по-программистски, что отчетливо
понял еще в марте. По-хорошему мне нужно найти источник денег (например тот же
кикстартер или индигоу) и нанять специальных крутых людей, чтобы они кучу
работы с сайтом, андроидным портом и дизайном сделали за меня.

Понимаю отчетливо, а делать ничего с этим не делаю и донейты на
биткоин-кошелек никто не отправляет. Такая вот печаль.

.. _приложение: /texr/
.. _выглядит страшно: http://i.imgur.com/nZ61OHL.jpg
.. _выглядит программистично: http://i.imgur.com/C9pqgCj.png
.. _посмотреть скриптом: https://gist.github.com/muromec/5990047
.. _скриптом через IPC: https://github.com/muromec/texr.client
